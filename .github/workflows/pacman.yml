name: Generate Pacman Stats

on:
  schedule:
    - cron: "0 12 * * *"
  workflow_dispatch:
  push:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          fetch-depth: 0

      - name: Setup Git
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"

      - name: Generate contribution grid (как основа)
        uses: Platane/snk@v3
        with:
          github_user_name: ${{ github.repository_owner }}
          outputs: |
            dist/contribution-grid.svg
          
      - name: Create Pacman overlay
        run: |
          # Создаем Пакмена поверх сетки контрибуций
          cat > dist/github-contribution-grid-snake.svg << 'EOF'
          <svg width="100%" height="170" xmlns="http://www.w3.org/2000/svg">
            <style>
              @keyframes eat {
                0%, 100% { clip-path: polygon(50% 50%, 100% 20%, 100% 80%); }
                50% { clip-path: polygon(50% 50%, 100% 40%, 100% 60%); }
              }
              .pacman-head {
                fill: #FFD700;
                animation: eat 0.5s infinite;
              }
            </style>
            
            <!-- Заголовок -->
            <text x="50%" y="20" text-anchor="middle" fill="#FFD700" font-family="Arial" font-size="16" font-weight="bold">
              🎮 Pacman eating my GitHub contributions!
            </text>
            
            <!-- Пакмен -->
            <g transform="translate(30, 60)">
              <!-- Тело Пакмена -->
              <circle cx="0" cy="0" r="25" class="pacman-head"/>
              
              <!-- Глаз -->
              <circle cx="-8" cy="-10" r="3" fill="#000"/>
            </g>
            
            <!-- Текст описания -->
            <text x="50%" y="150" text-anchor="middle" fill="#8b949e" font-family="Arial" font-size="12">
              Yellow dots are my contributions - Pacman is hungry!
            </text>
            
            <!-- Призраки в углу -->
            <g transform="translate(500, 50)">
              <text x="0" y="0" fill="#8b949e" font-family="Arial" font-size="10">Ghosts: Unmerged PRs</text>
            </g>
          </svg>
          EOF
          
      - name: Deploy to output branch
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./dist
          publish_branch: output
          force_orphan: true
          commit_message: "Update Pacman animation"
