name: Generate Pacman Stats

on:
  schedule:
    - cron: "0 12 * * *"
  workflow_dispatch:
  push:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          fetch-depth: 0

      - name: Setup Git
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"

      - name: Generate contribution grid (ÐºÐ°Ðº Ð¾ÑÐ½Ð¾Ð²Ð°)
        uses: Platane/snk@v3
        with:
          github_user_name: ${{ github.repository_owner }}
          outputs: |
            dist/contribution-grid.svg
          
      - name: Create Pacman overlay
        run: |
          # Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ ÐŸÐ°ÐºÐ¼ÐµÐ½Ð° Ð¿Ð¾Ð²ÐµÑ€Ñ… ÑÐµÑ‚ÐºÐ¸ ÐºÐ¾Ð½Ñ‚Ñ€Ð¸Ð±ÑƒÑ†Ð¸Ð¹
          cat > dist/github-contribution-grid-snake.svg << 'EOF'
          <svg width="100%" height="170" xmlns="http://www.w3.org/2000/svg">
            <style>
              @keyframes eat {
                0%, 100% { clip-path: polygon(50% 50%, 100% 20%, 100% 80%); }
                50% { clip-path: polygon(50% 50%, 100% 40%, 100% 60%); }
              }
              .pacman-head {
                fill: #FFD700;
                animation: eat 0.5s infinite;
              }
            </style>
            
            <!-- Ð—Ð°Ð³Ð¾Ð»Ð¾Ð²Ð¾Ðº -->
            <text x="50%" y="20" text-anchor="middle" fill="#FFD700" font-family="Arial" font-size="16" font-weight="bold">
              ðŸŽ® Pacman eating my GitHub contributions!
            </text>
            
            <!-- ÐŸÐ°ÐºÐ¼ÐµÐ½ -->
            <g transform="translate(30, 60)">
              <!-- Ð¢ÐµÐ»Ð¾ ÐŸÐ°ÐºÐ¼ÐµÐ½Ð° -->
              <circle cx="0" cy="0" r="25" class="pacman-head"/>
              
              <!-- Ð“Ð»Ð°Ð· -->
              <circle cx="-8" cy="-10" r="3" fill="#000"/>
            </g>
            
            <!-- Ð¢ÐµÐºÑÑ‚ Ð¾Ð¿Ð¸ÑÐ°Ð½Ð¸Ñ -->
            <text x="50%" y="150" text-anchor="middle" fill="#8b949e" font-family="Arial" font-size="12">
              Yellow dots are my contributions - Pacman is hungry!
            </text>
            
            <!-- ÐŸÑ€Ð¸Ð·Ñ€Ð°ÐºÐ¸ Ð² ÑƒÐ³Ð»Ñƒ -->
            <g transform="translate(500, 50)">
              <text x="0" y="0" fill="#8b949e" font-family="Arial" font-size="10">Ghosts: Unmerged PRs</text>
            </g>
          </svg>
          EOF
          
      - name: Deploy to output branch
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./dist
          publish_branch: output
          force_orphan: true
          commit_message: "Update Pacman animation"
